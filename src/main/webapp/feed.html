<!DOCTYPE html>
<html>
<head>
    <title>Message Feed</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
    <script src="/js/navigation-loader.js"></script>
    <meta charset="UTF-8">
    <!--    <link rel="stylesheet" href="/css/main.css">-->
    <!--    <link rel="stylesheet" href="/css/user-page.css">-->
    <style>
    #profile{
        position: relative;
        top: 10px;
        left:10px;
    }

    </style>
    <script>
    // Fetch messages and add them to the page.
   function fetchMessages(){
     const url = '/feed';
     fetch(url).then((response) => {
        return response.json();
     }).then((messages) => {
      const messageContainer = document.getElementById('message-container');
      if(messages.length == 0){
       messageContainer.innerHTML = '<p>There are no posts yet.</p>';
      }
      else{
       messageContainer.innerHTML = '';
      }
       messages.forEach((message) => {
       const messageDiv = buildMessageDiv(message);
       messageContainer.appendChild(messageDiv);
      });
    });
  }

   function buildMessageDiv(message){
       const usernameDiv = document.createElement('div');
       usernameDiv.classList.add("left-align");
       usernameDiv.appendChild(document.createTextNode(message.user));

       const timeDiv = document.createElement('div');
       timeDiv.classList.add('right-align');
       timeDiv.appendChild(document.createTextNode(new Date(message.timestamp)));

       const headerDiv = document.createElement('div');
       headerDiv.classList.add('message-header');
       headerDiv.appendChild(usernameDiv);
       headerDiv.appendChild(timeDiv);

       const bodyDiv = document.createElement('div');
       bodyDiv.classList.add('message-body');
       const messageBody = document.createElement('div');
       messageBody.innerHTML = message.text;
       bodyDiv.appendChild(messageBody);

       //create translate button
       bodyDiv.classList.add('translate-button');
       const translateButton = document.createElement("input");
       translateButton.type = "button";
       translateButton.value = "Translate";
       console.log(message.text);
       translateButton.addEventListener('click', function(){
           if (this.value === "Translate"){
                const language = window.navigator.language;
                const params = new URLSearchParams();
                params.append('text', message.text);
                params.append('languageCode', language);

                fetch('/translate', {
                  method: 'POST',
                  body: params
                }).then(response => response.text())
                .then((translatedMessage) => {
                  messageBody.innerHTML = translatedMessage;
                  this.value = 'See Original';
                });
           } else {
                messageBody.innerHTML = message.text;
                this.value = 'Translate';
           }
       });
   bodyDiv.appendChild(translateButton);

   const messageDiv = document.createElement('div');
   messageDiv.classList.add("message-div");
   messageDiv.appendChild(headerDiv);
   messageDiv.appendChild(bodyDiv);

   return messageDiv;
  }

  // Fetch data and populate the UI of the page.
  function buildUI(){
   fetchMessages();
  }



    </script>
</head>
<body onload="buildUI()">
<div id="app">
    <v-app>
        <v-content>
            <v-toolbar light color="white" class="elevation-0">
                <v-btn flat depressed large href="/index.html">
                    <v-toolbar-title class="black--text">SkillSync</v-toolbar-title>
                </v-btn>
                <v-spacer></v-spacer>
                <v-toolbar-items class="hidden-sm-and-down">
                    <v-btn flat href="/aboutus.html">About us</v-btn>
                    <v-btn flat href="/skill-search.html">Skill Search</v-btn>
                    <v-btn flat href="/feed.html">Public Feed</v-btn>
                    <v-avatar size='35' id="profile">
                        <img
                                src="https://image.flaticon.com/icons/png/512/97/97895.png"
                                alt="User"
                        >
                    </v-avatar>
                </v-toolbar-items>


            </v-toolbar>

            <div id="content">

                <div id="message-container">Loading...</div>
            </div>
        </v-content>
    </v-app>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
<script>
var indexVue = new Vue({
      el: '#app'
    })


</script>
</body>
</html>
